!> @file
!! @brief Codata module - autogenerated.
!! Fundamental Physical Constants --- Complete Listing
!! 2018 CODATA adjustment
!! From:  http://physics.nist.gov/constants
!! @example example_in_fortran.f90


!> @brief Codata constants
!! @details Codata constants wrapped in an array of derived type
!! with members name, value, uncertainty and unit.
!! Methods for getting the member values are available.
module codata
    use codata_data
    
    character(len=60), dimension(4), parameter :: headers = [character(len=60):: "Names", "Values", "Uncertainties", "Units"]

contains

    !> @brief Get the number of constants
    !! @return Number of constants
    pure function codata_get_number_constants() result(n)
        implicit none
        integer :: n
        n = size(codata_constants)
    end function

    !> @brief Get the number of constants
    !! @return Number of constants
    pure function codata_capi_get_number_constants() bind(C) result(n)
        use iso_c_binding, only : c_int
        integer(c_int) :: n
        n = codata_get_number_constants()
    end function


    !> @brief Display all constants.
    subroutine codata_print()
        implicit none
        integer :: i
        print "(A60, 4X, A23, 4X, A23, 4X, A25)", headers(:)
        do i=1, size(codata_constants)
            print "(A60, 4X, SP, ES23.16E2, 4X, ES23.16E2, 4X, A25)", codata_constants(i)%name, &
                                                                      codata_constants(i)%value, &
                                                                      codata_constants(i)%uncertainty, &
                                                                      codata_constants(i)%unit
        end do
    end subroutine

    !> @brief Display all constants.
    subroutine codata_capi_print() bind(C)
        implicit none
        call codata_print()
    end subroutine
    
    !> @brief Get the value of the constant by name
    !! @param[in] name Name of the constant
    !! @return value or NaN if not found
    pure function codata_get_value(name) result(value)
        use ieee_arithmetic, only : ieee_value, ieee_quiet_nan
        implicit none    
        character(len=*), intent(in) :: name
        real(real64) :: value
        integer :: i

        value = ieee_value(1.0d0, ieee_quiet_nan)

        do i=1, size(codata_constants)
            if (codata_constants(i)%name == name)then
                value = codata_constants(i)%value
                exit
            endif
        enddo
    end function

    !> @brief Get the value of the constant by name
    !! @param[in] name Name of the constant
    !! @param[in] length Length of the string
    !! @return value or NaN if not found
    function codata_capi_get_value(char_p, length) bind(C) result(value)
        use iso_c_binding, only : c_double, c_int, c_ptr, c_f_pointer
        implicit none
        integer(c_int), intent(in), value :: length
        type(c_ptr), intent(in), value :: char_p
        character, pointer, dimension(:) :: c2f_string
        real(c_double) :: value
        
        integer :: i
        character(len=length) :: name
        
        call c_f_pointer(char_p, c2f_string, shape=[length])

        do i=1, length
            name(i:i) = c2f_string(i)
        enddo

        value = codata_get_value(name)

    end function
    
    !> @brief Get the value of the constant by index 
    !! @param[in] index Index of the position.
    !! @return value or NaN if not found.
    pure function codata_get_value_by_index(index) result(value)
        use ieee_arithmetic, only : ieee_value, ieee_quiet_nan
        implicit none    
        integer, intent(in) :: index
        real(real64) :: value
        if (index > size(codata_constants))then
            value = ieee_value(1.0d0, ieee_quiet_nan)
        else
            value = codata_constants(index)%value
        endif
    end function
    
    !> @brief Get the value of the constant by index 
    !! @param[in] index Index of the position.
    !! @return value or NaN if not found.
    pure function codata_capi_get_value_by_index(index) bind(C) result(value)
        use iso_c_binding, only : c_int, c_double
        implicit none    
        integer(c_int), intent(in), value :: index
        real(c_double) :: value
        value = codata_get_value_by_index(index+1)
    end function

    !> @brief Get the name of the constant by index 
    !! @param[in] index Index of the position.
    !! @return name or empty if not found.
    pure function codata_get_name_by_index(index) result(name)
        implicit none    
        integer, intent(in) :: index
        character(len=:), allocatable, target :: name
        character(len)
        if (index > size(codata_constants))then
            name = ""
        else
            name = codata_constants(index)%name
        endif
    end function
    
    !> @brief Get the name of the constant by index 
    !! @param[in] index Index of the position.
    !! @return name or empty if not found.
    function codata_capi_get_name_by_index(index) bind(C) result(name)
        use iso_c_binding, only : c_null_char, c_ptr, c_loc
        implicit none
        integer, intent(in), value :: index
        type(c_ptr) :: name
        character(len=:), allocatable, target :: name_f
        character(len=:), pointer  :: name_f_ptr
        name_f_ptr => null()
        name_f = codata_get_name_by_index(index+1) // c_null_char
        name_f_ptr => name_f
        name = c_loc(name_f_ptr)
    end function

end module codata
