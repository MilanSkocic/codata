module cheader
    use iso_fortran_env
    use core
    implicit none

contains


subroutine write_C_header_declaration(fcode, version, name)
    !! Generate the C header declaration
    implicit none
    ! Arguments
    integer(int32), intent(in) :: fcode
        !! File unit of the C header.
    character(len=*), intent(in) :: version
        !! Version string
    character(len=*), intent(in) :: name
        !! Name string
    
    integer(int32) :: n 
    character(len=32) :: nstr

    n = len(trim(version)) ! remove quotes for size and +1 for c final null char.
    
    write(nstr, "(I2)") n - 2 + 1

    write(fcode, "(A)") '/**'
    write(fcode, "(A)") '* @file'
    write(fcode, "(A) ") '* @brief Version - autogenerated.'
    write(fcode, "(A)") "*/"
    write(fcode, "(A)") ""
    write(fcode, "(A)") '#ifndef '//trim(name)//'_VERSION_H'
    write(fcode, "(A)") '#define '//trim(name)//'_VERSION_H'
    write(fcode, "(A)") "#if _MSC_VER"
    write(fcode, "(A)") "#define ADD_IMPORT __declspec(dllimport)"
    write(fcode, "(A)") "#else"
    write(fcode, "(A)") "#define ADD_IMPORT"
    write(fcode, "(A)") "#endif"
    
    write(fcode, "(A)") 'ADD_IMPORT extern const char '//trim(name)//'_version_capi_version['//trim(nstr)//'];'

    
end subroutine


subroutine write_C_header_end(fcode)
    !! Generate the C header declaration
    implicit none
    ! Arguments
    integer(int32), intent(in) :: fcode
        !! File unit of the C header.
    write(fcode, "(A)") '#endif'
    write(fcode, "(A)") ''
    
end subroutine


end module